---
phase: 05-test-&-deploy
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .env.production.example
  - DEPLOYMENT.md
  - package.json
autonomous: true
user_setup:
  - service: n8n
    why: "Production webhook URL needed for form submissions"
    env_vars:
      - name: NEXT_PUBLIC_N8N_WEBHOOK_URL
        source: "n8n Dashboard -> Workflows -> Lead Registration - Moka Dijital -> Webhook node -> Production URL"
    dashboard_config:
      - task: "Activate workflow 'Lead Registration - Moka Dijital'"
        location: "n8n Dashboard -> Workflows -> Lead Registration - Moka Dijital -> Active toggle (top right)"
      - task: "Copy production webhook URL"
        location: "n8n Dashboard -> Workflows -> Lead Registration - Moka Dijital -> Webhook node -> Production URL"

must_haves:
  truths:
    - "Production environment configuration file exists with all required variables"
    - "Deployment documentation covers pre-deploy checklist, upload steps, and post-deploy verification"
    - "Build command generates clean static export in out/ folder"
    - "Production build can be tested locally before upload"
  artifacts:
    - path: ".env.production.example"
      provides: "Production environment variable template"
      contains: "NEXT_PUBLIC_N8N_WEBHOOK_URL, NEXT_PUBLIC_BASE_URL"
    - path: "DEPLOYMENT.md"
      provides: "Deployment documentation"
      min_lines: 60
    - path: "package.json"
      provides: "Build scripts"
      contains: "\"build\": \"next build\""
  key_links:
    - from: "DEPLOYMENT.md"
      to: ".env.production.example"
      via: "Documentation reference"
      pattern: "env.*production"
---

<objective>
Prepare production configuration and deployment documentation for static export deployment to PHP hosting.

Purpose: Create reproducible deployment process with clear documentation and environment configuration. Output includes .env.production.example template, DEPLOYMENT.md guide, and verified build command.
</objective>

<execution_context>
@C:\Users\Omer\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\Omer\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.env.local.example
@next.config.mjs
@package.json

# Phase 3 Summary (n8n webhook setup)
@.planning/phases/03-form-entegrasyonu-&-n8n-webhook/03-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create .env.production.example template</name>
  <files>.env.production.example</files>
  <action>
    Create .env.production.example file in project root with production-ready environment variable template:

    1. Copy structure from existing .env.local.example
    2. Add NEXT_PUBLIC_BASE_URL=https://mokadijital.com (production domain)
    3. Add NEXT_PUBLIC_N8N_WEBHOOK_URL with production URL placeholder
    4. Add clear instructions for n8n workflow activation:
       - Go to https://ai.mokadijital.com
       - Open workflow "Lead Registration - Moka Dijital" (ID: XhpDEv1l5IgxWKPL)
       - Click Active toggle to enable
       - Copy Production URL from Webhook node
    5. Add comment about renaming to .env.local for production builds
    6. Keep existing webhook payload documentation

    Do NOT create .env.local (that's user setup). Only create .env.production.example.
  </action>
  <verify>File exists at project root, contains NEXT_PUBLIC_BASE_URL and NEXT_PUBLIC_N8N_WEBHOOK_URL with clear setup instructions</verify>
  <done>.env.production.example template ready for user to configure before deployment</done>
</task>

<task type="auto">
  <name>Task 2: Create DEPLOYMENT.md documentation</name>
  <files>DEPLOYMENT.md</files>
  <action>
    Create DEPLOYMENT.md file in project root with comprehensive deployment guide:

    1. **Pre-Deploy Checklist** (5-7 items):
       - n8n workflow activated in production
       - .env.local configured with production webhook URL
       - npm run build completes without errors
       - out/ folder contains expected files
       - Test locally with npx serve@latest out

    2. **Build Steps** (numbered commands):
       - npm install (if needed)
       - npm run build
       - Verify out/ folder contents

    3. **Upload Methods** (3 options):
       - Option A: cPanel File Manager (zip out/, upload, extract)
       - Option B: FTP/SFTP (upload entire out/ folder)
       - Option C: FileZilla or similar FTP client

    4. **Upload Location**:
       - public_html or www root directory
       - Full replacement (delete old files, upload new out/ contents)
       - Preserve .htaccess if exists

    5. **Post-Deploy Verification** (5-7 checks):
       - Homepage loads at https://mokadijital.com
       - All 6 service pages accessible (/hizmetler/*)
       - Contact forms open and submit successfully
       - n8n workflow receives lead data
       - Test on mobile devices
       - Check browser console for errors

    6. **Troubleshooting** (3-5 common issues):
       - 404 errors (check file paths)
       - Form not submitting (check webhook URL in .env.local)
       - Images not loading (check public folder)

    Use clear headings, code blocks for commands, and bullet points for checklists.
  </action>
  <verify>File exists, contains all 6 sections (Pre-Deploy, Build Steps, Upload Methods, Upload Location, Verification, Troubleshooting), min 60 lines</verify>
  <done>Complete deployment documentation with pre-deploy checklist, upload instructions, and verification steps</done>
</task>

<task type="auto">
  <name>Task 3: Verify build command and output</name>
  <files>package.json</files>
  <action>
    Run npm run build and verify output:

    1. Check package.json has "build": "next build" script
    2. Run npm run build
    3. Verify build completes with 0 errors
    4. Check out/ folder structure contains:
       - index.html (homepage)
       - hizmetler/ (service pages directory)
       - _next/static/ (static assets)
       - robots.txt
       - sitemap.xml
       - 404.html
    5. Note total build time and file sizes
    6. Confirm static export works (output: 'export' in next.config.mjs)

    If any errors occur, document them in DEPLOYMENT.md troubleshooting section.
  </action>
  <verify>npm run build completes successfully, out/ folder contains index.html, hizmetler/, _next/, robots.txt, sitemap.xml, 404.html</verify>
  <done>Static export build verified and ready for deployment</done>
</task>

</tasks>

<verification>
Overall phase checks:
1. .env.production.example template exists with all required variables documented
2. DEPLOYMENT.md contains complete deployment workflow from pre-deploy to post-deploy verification
3. Build command (npm run build) generates clean static export in out/ folder
4. Documentation covers cPanel, FTP, and SFTP upload methods
5. User has clear checklist for n8n workflow activation and webhook URL configuration
</verification>

<success_criteria>
- Production configuration template (.env.production.example) created with clear setup instructions
- Deployment documentation (DEPLOYMENT.md) covers all deployment steps from build to verification
- Static export build verified and documented (build time, output structure)
- User can follow documentation independently to deploy to PHP hosting
</success_criteria>

<output>
After completion, create `.planning/phases/05-test-&-deploy/05-01-SUMMARY.md`
</output>
